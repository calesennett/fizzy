<% @page_title = "Create a new board" %>

<div class="panel panel--centered">
  <%= form_with model: @board, class: "flex flex-column gap", data: { controller: "form", action: "submit->form#preventEmptySubmit" } do |form| %>
    <h1 class="txt-x-large margin-none font-weight-black"><%= @page_title %></h1>
    <%= form.text_field :name, required: true, class: "input full-width", autofocus: true, autocomplete: "off", placeholder: "Name it…", data: { form_target: "input", action: "keydown.esc@document->form#cancel", validation_message: "Board names can‘t be blank" } %>

    <% if @importable_boards.any? %>
      <div class="flex flex-column gap-half" data-controller="boards-import">
        <div class="flex align-center justify-center gap-half txt-small txt-nowrap">
          <label class="flex align-center gap-half">
            <%= check_box_tag :import_columns_from_board, "1", false, class: "step__checkbox", data: { action: "boards-import#toggle", boards_import_target: "checkbox" } %>
            <span>Copy columns from</span>
          </label>

          <%= tag.div class: "quick-filter", data: {
                controller: "dialog combobox",
                action: "keydown.esc->dialog#close click@document->dialog#closeOnClickOutside",
                combobox_default_value_value: "",
                combobox_default_label_value: "Select a board...",
                combobox_with_default_class: "quick-filter--with-default"
              } do %>
            <button type="button" class="btn input input--select flex-inline txt-small" data-action="click->dialog#toggle:stop" data-boards-import-target="toggleButton">
              <span class="overflow-ellipsis" data-combobox-target="label"></span>
            </button>

            <template data-combobox-target="hiddenFieldTemplate">
              <%= hidden_field_tag :import_columns_from_board_id, nil, data: { boards_import_target: "hiddenField" } %>
            </template>

            <%= filter_dialog "Copy columns from board" do %>
              <strong class="popup__title">Copy columns from…</strong>
              <ul class="popup__list" role="listbox">
                <%= tag.li class: "popup__item", data: { navigable_list_target: "item", combobox_target: "item", combobox_value: "", combobox_label: "Select a board..." }, role: "checkbox", aria: { checked: true } do %>
                  <button type="button" class="btn popup__btn" data-action="dialog#close combobox#change boards-import#selectChanged" data-boards-import-target="defaultButton">
                    <span class="overflow-ellipsis flex-item-grow">Select a board...</span>
                    <%= icon_tag "check", class: "checked flex-item-justify-end" %>
                  </button>
                <% end %>

                <% @importable_boards.each do |board| %>
                  <%= tag.li class: "popup__item", data: { navigable_list_target: "item", combobox_target: "item", combobox_value: board.id, combobox_label: board.name }, role: "checkbox", aria: { checked: false } do %>
                    <button type="button" class="btn popup__btn" data-action="dialog#close combobox#change boards-import#selectChanged">
                      <span class="overflow-ellipsis flex-item-grow"><%= board.name %></span>
                      <%= icon_tag "check", class: "checked flex-item-justify-end" %>
                    </button>
                  <% end %>
                <% end %>
              </ul>
            <% end %>
          <% end %>
        </div>
      </div>
    <% end %>

    <button type="submit" class="btn btn--link center">
      <span>Create board</span>
      <%= icon_tag "arrow-right" %>
    </button>

    <%= link_to "Cancel and go back", root_path, data: { form_target: "cancel", turbo_frame: "_top" }, hidden: true %>
  <% end %>
</div>
